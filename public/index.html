<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebSocket Test</title>
  </head>
  <body>
    <h1>WebSocket Test Client</h1>
    <p>Check console for WebSocket events.</p>

    <!-- User ID 입력 필드 -->
    <label for="userIdInput">User ID:</label>
    <input type="text" id="userIdInput" placeholder="Enter your user ID" />
    <button onclick="connectWebSocket()">Connect</button>

    <!-- 메시지 입력 필드 -->
    <input
      type="text"
      id="messageInput"
      placeholder="Type a message"
      disabled
    />
    <button id="sendButton" onclick="sendMessage()" disabled>Send</button>

    <script>
      let socket; // WebSocket 객체를 저장할 변수
      let userId; // 사용자 ID를 저장할 변수

      // WebSocket 서버에 연결
      function connectWebSocket() {
        const userIdInput = document.getElementById("userIdInput");
        userId = userIdInput.value.trim();

        if (!userId) {
          alert("Please enter a valid User ID.");
          return;
        }

        // 현재 브라우저의 URL을 기준으로 WebSocket 주소 생성
        const wsProtocol =
          window.location.protocol === "https:" ? "wss://" : "ws://";
        const wsUrl = `${wsProtocol}${window.location.host}/ws/${userId}`;

        socket = new WebSocket(wsUrl);

        // WebSocket 이벤트 리스너 설정
        socket.addEventListener("open", () => {
          console.log("WebSocket connection established");
          document.getElementById("messageInput").disabled = false;
          document.getElementById("sendButton").disabled = false;
        });

        socket.addEventListener("message", (event) => {
          console.log("Message from server:", event.data);
        });

        socket.addEventListener("close", () => {
          console.log("WebSocket connection closed");
          document.getElementById("messageInput").disabled = true;
          document.getElementById("sendButton").disabled = true;
        });

        socket.addEventListener("error", (error) => {
          console.error("WebSocket error:", error);
        });
      }

      // 서버에 메시지 전송
      function sendMessage() {
        const messageInput = document.getElementById("messageInput");
        const message = {
          from: userId,
          to: "anotherUser", // Replace with the recipient's user ID
          event: "CUSTOM_EVENT",
          data: messageInput.value,
        };

        if (socket && socket.readyState === WebSocket.OPEN) {
          socket.send(JSON.stringify(message));
          console.log("Message sent:", message);
          messageInput.value = "";
        } else {
          console.error("WebSocket is not connected.");
        }
      }
    </script>
  </body>
</html>
